<div class="min-h-screen bg-gradient-to-br from-[#0f172a] to-[#1e293b] text-slate-100">
  <div class="mx-auto max-w-6xl px-4 py-8">

    <!-- VISSZA GOMB -->
    <button *ngIf="!isLoading" (click)="goBack()"
            class="mb-6 group flex items-center text-amber-400 hover:text-amber-300 transition-colors">
      <i class="bi bi-arrow-left mr-2 group-hover:-translate-x-1 transition-transform"></i>
      Back to Loops
    </button>

    <!-- HEADER SECTION -->
<section class="rounded-2xl border border-slate-600/30 bg-gradient-to-b from-slate-800/80 to-slate-900/80 backdrop-blur-sm shadow-xl">
  <div class="p-6 sm:p-8">
    <div class="flex flex-col sm:flex-row sm:items-start justify-between gap-4">
      <div class="flex-1">
        <div class="flex flex-wrap items-center gap-3 mb-3">
          <h1 class="text-3xl font-bold tracking-tight bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent break-all">
            {{ loop?.filename || 'Untitled Loop' }}
          </h1>
          <span *ngIf="loop?.bpm"
                class="inline-flex items-center gap-1 rounded-full border border-emerald-400/40 bg-emerald-500/15 px-2.5 py-1 text-xs font-medium text-emerald-300">
            <i class="bi bi-speedometer2"></i> {{ loop?.bpm }} BPM
          </span>
        </div>

        <!-- META -->
        <div class="flex flex-wrap items-center gap-4 text-sm text-slate-300">
          <span class="inline-flex items-center gap-2 rounded-lg bg-slate-800/50 px-3 py-1.5">
            <i class="bi bi-person text-amber-400"></i>
            <a *ngIf="loop?.uploader?.username && loop.uploader.username !== 'Ismeretlen'"
               [routerLink]="['/profile', loop.uploader.username]" class="hover:text-amber-300 hover:underline">
              {{ loop.uploader.username }}
            </a>
            <span *ngIf="!loop?.uploader?.username || loop.uploader.username === 'Ismeretlen'">Ismeretlen</span>
          </span>

          <span class="inline-flex items-center gap-2 rounded-lg bg-slate-800/50 px-3 py-1.5">
            <i class="bi bi-calendar-event text-orange-400"></i>
            {{ loop?.uploadDate | date:'yyyy.MM.dd. HH:mm' }}
          </span>

          <span *ngIf="loop?.key" class="inline-flex items-center gap-2 rounded-lg bg-slate-800/50 px-3 py-1.5">
            <i class="bi bi-music-note text-emerald-400"></i>
            {{ loop?.key }} {{ loop?.scale }}
          </span>
        </div>

        <!-- TAGEK -->
        <div *ngIf="loop?.tags?.length" class="mt-4 flex flex-wrap gap-2">
          <span *ngFor="let tag of loop.tags"
                class="inline-flex items-center px-2.5 py-1 rounded-full text-xs font-medium bg-slate-800/60 text-slate-300 border border-slate-700/50 hover:bg-slate-700/60 transition-colors">
            <i class="bi bi-tag mr-1 text-amber-400/70"></i> {{ tag }}
          </span>
        </div>
      </div>

      <div class="w-full sm:w-auto">
        <div class="flex items-center justify-end gap-4 text-sm text-slate-300">
          <span class="flex items-center gap-1"><i class="bi bi-download text-orange-400"></i><span class="font-semibold">{{ loop?.downloads || 0 }}</span></span>
          <span class="flex items-center gap-1"><i class="bi bi-heart text-rose-400"></i><span class="font-semibold">{{ loop?.likes || 0 }}</span></span>
          <span class="flex items-center gap-1"><i class="bi bi-chat text-amber-400"></i><span class="font-semibold">{{ comments.length }}</span></span>
        </div>
        <div class="mt-2 flex items-center justify-end gap-2">
          <button (click)="toggleLike()" class="inline-flex h-10 w-10 items-center justify-center rounded-full text-slate-400 hover:text-rose-500 focus:outline-none">
            <i class="bi text-lg" [class.bi-heart]="!hasLiked()" [class.bi-heart-fill]="hasLiked()" [ngClass]="hasLiked() ? 'text-rose-500' : 'text-slate-400'"></i>
          </button>
          <button (click)="toggleFavorite(loop)" class="inline-flex h-10 w-10 items-center justify-center rounded-full text-slate-400 hover:text-amber-500 focus:outline-none">
            <i class="bi text-lg" [class.bi-star]="!isFavorite(loop._id)" [class.bi-star-fill]="isFavorite(loop._id)" [ngClass]="isFavorite(loop._id) ? 'text-amber-500' : 'text-slate-400'"></i>
          </button>
          <button (click)="downloadLoop()" class="inline-flex h-10 w-10 items-center justify-center rounded-full text-slate-400 hover:text-emerald-400 focus:outline-none"><i class="bi bi-download"></i></button>
          <ng-container *ngIf="!isAdmin; else adminActionBar">
            <button (click)="openLoopReportModal()" class="inline-flex h-10 w-10 items-center justify-center rounded-full text-slate-400 hover:text-rose-400 focus:outline-none"><i class="bi bi-flag"></i></button>
          </ng-container>
          <ng-template #adminActionBar>
            <button (click)="adminDeleteLoop()" class="inline-flex h-10 w-10 items-center justify-center rounded-full text-slate-400 hover:text-rose-400 focus:outline-none"><i class="bi bi-trash"></i></button>
            <button (click)="openEditModal()" class="inline-flex h-10 w-10 items-center justify-center rounded-full text-slate-400 hover:text-amber-400 focus:outline-none"><i class="bi bi-pencil"></i></button>
          </ng-template>
        </div>
      </div>
    </div>

    <!-- RÉSZLETEK -->
    <div class="mt-6 grid grid-cols-1 sm:grid-cols-2 gap-4">
      <div *ngIf="loop?.instrument" class="flex items-center p-4 rounded-xl bg-slate-700/40 border border-slate-600/30">
        <div class="flex-shrink-0 p-2 bg-amber-500/20 rounded-lg mr-4"><i class="bi bi-music-note-beamed text-amber-400 text-lg"></i></div>
        <div><p class="text-xs text-slate-400 mb-1">Instrument</p><p class="text-sm font-medium text-slate-200">{{ loop.instrument }}</p></div>
      </div>
      <div *ngIf="loop?.key" class="flex items-center p-4 rounded-xl bg-slate-700/40 border border-slate-600/30">
        <div class="flex-shrink-0 p-2 bg-blue-500/20 rounded-lg mr-4"><i class="bi bi-music-note-list text-blue-400 text-lg"></i></div>
        <div><p class="text-xs text-slate-400 mb-1">Key & Scale</p><p class="text-sm font-medium text-slate-200">{{ loop.key }} {{ loop.scale }}</p></div>
      </div>
    </div>

    <!-- LEJÁTSZÓ -->
    <div class="mt-6 rounded-2xl border border-slate-600/30 bg-slate-800/40 p-6">
      <audio #audioPlayer id="loop-audio-player" [src]="getAudioUrl(loop.path)" hidden
             (play)="onAudioPlay()" (pause)="onAudioPause()" (error)="onAudioError(audioPlayer)" (timeupdate)="updateProgress()"></audio>

      <!-- Waveform -->
      <div class="relative h-32 mb-6 bg-slate-700/40 rounded-xl overflow-hidden cursor-pointer border border-slate-600/30"
           (click)="seekAudio($event, true)">
        <div class="absolute inset-0 flex items-center">
          <div class="w-full h-20 flex items-center px-4">
            <div *ngFor="let value of waveform; let i = index"
                 class="waveform-bar mx-0.5 rounded transition-all duration-100 bg-slate-600/60 hover:bg-slate-500/60"
                 [style.height.%]="value * 0.8"></div>
          </div>
        </div>
        <div class="absolute inset-0 flex items-center overflow-hidden" [style.width.%]="progress">
          <div class="h-20 flex items-center px-4">
            <div *ngFor="let value of waveform; let i = index"
                 class="waveform-bar mx-0.5 rounded transition-all duration-100 bg-gradient-to-b from-amber-400 to-orange-400"
                 [style.height.%]="value * 0.8"></div>
          </div>
        </div>
        <div class="absolute top-0 bottom-0 w-1 bg-white ml-1 shadow-lg shadow-amber-400/40" [style.left.%]="progress"></div>
      </div>

      <!-- Controls -->
      <div class="flex items-center justify-between">
        <button (click)="togglePlay()" class="flex items-center justify-center w-14 h-14 rounded-full bg-gradient-to-br from-amber-500 to-orange-500 hover:from-amber-400 hover:to-orange-400 text-white transition-all transform hover:scale-105 active:scale-95 shadow-lg hover:shadow-amber-400/30">
          <i *ngIf="!isPlaying" class="bi bi-play-fill text-xl ml-1"></i>
          <i *ngIf="isPlaying" class="bi bi-pause-fill text-xl"></i>
        </button>

        <div class="flex-1 mx-6 flex items-center">
          <span class="text-sm font-medium text-slate-300 w-12 text-right">{{ formatTime(currentTime) }}</span>
          <div class="flex-1 mx-4 relative h-2 bg-slate-700/60 rounded-full overflow-hidden cursor-pointer group"
               (click)="seekAudio($event, false)">
            <div class="absolute inset-y-0 left-0 bg-gradient-to-r from-amber-400 to-orange-400 rounded-full" [style.width.%]="progress"></div>
            <div class="absolute top-0 bottom-0 w-3 bg-white rounded-full -ml-1.5 shadow-lg shadow-amber-400/40 opacity-0 group-hover:opacity-100 transition-opacity" [style.left.%]="progress"></div>
          </div>
          <span class="text-sm font-medium text-slate-300 w-12">{{ formatTime(duration) }}</span>
        </div>

        <div class="flex items-center space-x-3">
          <i class="bi bi-volume-up text-slate-400"></i>
          <input type="range" min="0" max="1" step="0.01" [(ngModel)]="volume" (input)="setVolume()"
                 class="w-24 h-1 bg-slate-700/60 rounded-full appearance-none cursor-pointer
                        [&::-webkit-slider-thumb]:appearance-none [&::-webkit-slider-thumb]:h-3 [&::-webkit-slider-thumb]:w-3
                        [&::-webkit-slider-thumb]:rounded-full [&::-webkit-slider-thumb]:bg-white
                        [&::-webkit-slider-thumb]:border [&::-webkit-slider-thumb]:border-slate-400 hover:[&::-webkit-slider-thumb]:bg-amber-400">
        </div>
      </div>
    </div>
    <div *ngIf="loop?.description" class="mt-6">
      <h3 class="text-lg font-semibold mb-3 text-amber-400"><i class="bi bi-card-text mr-2"></i>Description</h3>
      <p class="text-slate-300 whitespace-pre-wrap bg-slate-700/40 rounded-lg p-4 border border-slate-600/30">
        {{ loop.description }}
      </p>
    </div>
  </div>
</section>

    <!-- COMMENTS SECTION -->
    <section class="mt-6 rounded-2xl border border-slate-600/30 bg-gradient-to-b from-slate-800/80 to-slate-900/80 shadow-xl">
      
      <div class="lg:col-span-2 space-y-6">

      
        <div class="rounded-2xl border border-slate-600/30 bg-gradient-to-b from-slate-800/80 to-slate-900/80 shadow-xl backdrop-blur-sm">
          <div class="p-6 border-b border-slate-600/30">
            <div class="flex justify-between items-center">
              <h2 class="text-xl font-bold bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent">
                Comments
              </h2>
              <span class="text-sm font-medium bg-slate-700/60 text-slate-300 px-3 py-1 rounded-full border border-slate-600/30">
                {{ comments.length }} {{ comments.length === 1 ? 'comment' : 'comments' }}
              </span>
            </div>
          </div>

          <div class="p-6">
            <div *ngIf="comments.length === 0"
                 class="text-center py-12 bg-slate-700/40 rounded-xl border-2 border-dashed border-slate-600/50 backdrop-blur-sm">
              <i class="bi bi-chat-dots text-5xl text-slate-500 mb-4"></i>
              <h3 class="text-lg font-semibold text-slate-300 mb-2">No comments yet</h3>
              <p class="text-slate-400 mb-6">Be the first to comment on this loop</p>
              <button *ngIf="!isLoggedIn" (click)="handleLogin()"
                      class="inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-amber-600 to-orange-600 px-4 py-2 text-sm font-medium hover:from-amber-500 hover:to-orange-500 transition-all">
                <i class="bi bi-box-arrow-in-right"></i> Sign in to comment
              </button>
            </div>

            <!-- Comments list -->
            <div *ngIf="comments.length > 0" class="space-y-4">
              <div *ngFor="let comment of comments"
                   class="p-4 rounded-xl bg-slate-700/40 border border-slate-600/30 backdrop-blur-sm transition-all hover:border-amber-500/30">
                <div class="flex items-start space-x-4">
                  <div class="flex-shrink-0">
                    <div class="h-12 w-12 rounded-full bg-gradient-to-br from-amber-500/20 to-orange-500/20 flex items-center justify-center overflow-hidden border-2 border-slate-600/50 shadow-lg">
                      <img *ngIf="comment.user?.profileImage" [src]="getImageUrl(comment.user.profileImage)"
                           class="h-full w-full object-cover">
                      <span *ngIf="!comment.user?.profileImage" class="text-amber-400 font-medium text-sm">
                        {{ comment.user?.username?.charAt(0)?.toUpperCase() || '?' }}
                      </span>
                    </div>
                  </div>

                  <div class="flex-1 min-w-0">
                    <div class="flex items-baseline flex-wrap gap-2 mb-2">
                      <p class="text-sm font-medium text-slate-200">
                        {{ comment.user?.username || 'Unknown' }}
                      </p>
                      <span *ngIf="comment.user?.role === 'admin'"
                            class="text-xs bg-gradient-to-r from-purple-500/20 to-pink-500/20 text-purple-300 px-2 py-0.5 rounded-full border border-purple-500/30">
                        Admin
                      </span>
                      <span class="ml-auto text-xs text-slate-400">
                        {{ comment.createdAt | date:'MMM dd, yyyy • HH:mm' }}
                      </span>

                      <ng-container *ngIf="!isAdmin; else adminCommentActions">
                        <button *ngIf="isLoggedIn"
                                (click)="openReportModal(comment._id)"
                                class="ml-2 text-xs px-2 py-1 rounded bg-rose-500/20 text-rose-300 border border-rose-500/30 hover:bg-rose-500/30 transition">
                          Report
                        </button>
                      </ng-container>

                      <ng-template #adminCommentActions>
                        <button (click)="adminDeleteComment(comment._id)"
                                [disabled]="isDeletingCommentId === comment._id"
                                class="ml-2 text-xs px-2 py-1 rounded bg-rose-600 text-white hover:bg-rose-700 disabled:opacity-60 transition">
                          {{ isDeletingCommentId === comment._id ? 'Deleting...' : 'Delete' }}
                        </button>
                      </ng-template>
                    </div>
                    <p class="text-slate-300 whitespace-pre-wrap text-sm">
                      {{ comment.text }}
                    </p>
                  </div>
                </div>
              </div>
            </div>

            <!-- Comment -->
            <div *ngIf="isLoggedIn" class="mt-8 pt-6 border-t border-slate-600/30">
              <h3 class="text-lg font-medium text-amber-400 mb-4">Add Comment</h3>
              <textarea [(ngModel)]="newComment" 
                        placeholder="Write your comment here..."
                        class="w-full p-4 border border-slate-600/50 bg-slate-700/40 rounded-xl focus:outline-none focus:ring-2 focus:ring-amber-400/40 focus:border-amber-400/30 text-slate-100 placeholder-slate-400 backdrop-blur-sm transition duration-200"
                        rows="4" 
                        maxlength="500"></textarea>

              <div class="flex justify-between items-center mt-3">
                <div class="text-sm text-slate-400">
                  {{ newComment.length }} / 500 characters
                </div>
                <button (click)="addComment()" 
                        [disabled]="isAddingComment || !newComment.trim() || newComment.length > 500"
                        class="inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-amber-600 to-orange-600 px-5 py-2.5 text-sm font-medium hover:from-amber-500 hover:to-orange-500 disabled:opacity-50 disabled:cursor-not-allowed transition-all">
                  <i *ngIf="!isAddingComment" class="bi bi-send"></i>
                  <i *ngIf="isAddingComment" class="bi bi-arrow-repeat animate-spin"></i>
                  {{ isAddingComment ? 'Sending...' : 'Send Comment' }}
                </button>
              </div>
            </div>

            <!-- Login -->
            <div *ngIf="!isLoggedIn" class="mt-8 pt-6 border-t border-slate-600/30">
              <div class="bg-slate-700/40 p-5 rounded-xl text-center border border-slate-600/30 backdrop-blur-sm">
                <i class="bi bi-chat-square-text text-3xl text-amber-400 mb-3"></i>
                <h3 class="text-lg font-medium text-slate-200 mb-2">Sign in required</h3>
                <p class="text-slate-400 mb-4">You need to be signed in to comment on loops</p>
                <button (click)="handleLogin()"
                        class="inline-flex items-center gap-2 rounded-lg bg-gradient-to-r from-amber-600 to-orange-600 px-5 py-2.5 text-sm font-medium hover:from-amber-500 hover:to-orange-500 transition-all">
                  <i class="bi bi-box-arrow-in-right"></i> Sign In
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </div>
</div>

<!-- MODALS -->
<div *ngIf="isEditModalOpen"
     class="fixed inset-0 z-50 grid place-items-center bg-black/70 p-4 backdrop-blur-sm"
     (click)="closeEditModal($event)">
  <div class="relative w-full max-w-lg rounded-2xl border border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900 p-6 shadow-xl"
       (click)="$event.stopPropagation()">
    <div class="mb-4 flex items-center justify-between">
      <h3 class="text-lg font-semibold !text-slate-100">Edit Loop</h3>
      <button (click)="isEditModalOpen=false"
              class="rounded-full p-2 text-slate-400 hover:bg-slate-700/50 hover:text-slate-200 transition-all">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <div class="space-y-4">
      <div>
        <label class="mb-1 block text-sm font-medium text-slate-300">Name</label>
        <input type="text" [(ngModel)]="editForm.name"
               class="w-full rounded-xl border border-slate-600/50 bg-slate-700/50 p-3 text-slate-100 focus:border-amber-400/50 focus:ring-2 focus:ring-amber-400/20 backdrop-blur-sm"/>
      </div>

      <div class="grid grid-cols-1 gap-4 sm:grid-cols-2">
        <div>
          <label class="mb-1 block text-sm font-medium text-slate-300">BPM</label>
          <input type="number" [(ngModel)]="editForm.bpm" min="40" max="300"
                 class="w-full rounded-xl border border-slate-600/50 bg-slate-700/50 p-3 text-slate-100 focus:border-amber-400/50 focus:ring-2 focus:ring-amber-400/20 backdrop-blur-sm"/>
        </div>
        <div>
          <label class="mb-1 block text-sm font-medium text-slate-300">Key</label>
          <select [(ngModel)]="editForm.key"
                  class="w-full rounded-xl border border-slate-600/50 bg-slate-700/50 p-3 text-slate-100 focus:border-amber-400/50 focus:ring-2 focus:ring-amber-400/20 backdrop-blur-sm">
            <option value="">—</option>
            <option *ngFor="let k of keys" [value]="k">{{ k }}</option>
          </select>
        </div>
        <div>
          <label class="mb-1 block text-sm font-medium text-slate-300">Scale</label>
          <select [(ngModel)]="editForm.scale"
                  class="w-full rounded-xl border border-slate-600/50 bg-slate-700/50 p-3 text-slate-100 focus:border-amber-400/50 focus:ring-2 focus:ring-amber-400/20 backdrop-blur-sm">
            <option value="">—</option>
            <option *ngFor="let s of scales" [value]="s">{{ s }}</option>
          </select>
        </div>
        <div>
          <label class="mb-1 block text-sm font-medium text-slate-300">Instrument</label>
          <select [(ngModel)]="editForm.instrument"
                  class="w-full rounded-xl border border-slate-600/50 bg-slate-700/50 p-3 text-slate-100 focus:border-amber-400/50 focus:ring-2 focus:ring-amber-400/20 backdrop-blur-sm">
            <option value="">—</option>
            <option *ngFor="let i of instruments" [value]="i">{{ i }}</option>
          </select>
        </div>
      </div>

      <div>
        <label class="mb-1 block text-sm font-medium text-slate-300">Tags (comma separated)</label>
        <input type="text" [(ngModel)]="editForm.tags" placeholder="hiphop, trap, dark"
               class="w-full rounded-xl border border-slate-600/50 bg-slate-700/50 p-3 text-slate-100 placeholder-slate-400 focus:border-amber-400/50 focus:ring-2 focus:ring-amber-400/20 backdrop-blur-sm"/>
      </div>

      <div *ngIf="editError" class="text-sm text-rose-400">{{ editError }}</div>
    </div>

    <div class="mt-6 flex justify-end gap-2">
      <button (click)="isEditModalOpen=false"
              class="inline-flex items-center gap-2 rounded-full border border-slate-600/50 bg-slate-700/50 px-5 py-2.5 text-sm font-medium text-slate-300 transition-all hover:bg-slate-600/50 backdrop-blur-sm">
        Cancel
      </button>
      <button (click)="saveLoopEdit()" [disabled]="isSavingEdit"
              class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-amber-600 to-orange-600 px-5 py-2.5 text-sm font-semibold text-white transition-all hover:from-amber-500 hover:to-orange-500 disabled:opacity-50">
        {{ isSavingEdit ? 'Saving...' : 'Save Changes' }}
      </button>
    </div>
  </div>
</div>

<!-- LOOP REPORT MODAL -->
<div *ngIf="isLoopReportOpen"
     class="fixed inset-0 z-50 grid place-items-center bg-black/70 p-4 backdrop-blur-sm"
     (click)="closeLoopReportModal($event)">
  <div class="relative w-full max-w-md rounded-2xl border border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900 p-6 shadow-xl"
       (click)="$event.stopPropagation()">
    <div class="mb-4 flex items-center justify-between">
      <h3 class="text-lg font-semibold text-slate-100">Report Loop</h3>
      <button (click)="isLoopReportOpen=false"
              class="rounded-full p-2 text-slate-400 hover:bg-slate-700/50 hover:text-slate-200 transition-all">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <p class="mb-3 text-sm text-slate-400">Please briefly describe the issue with this loop.</p>
    <textarea [(ngModel)]="loopReportReason"
              rows="5" maxlength="1000"
              class="w-full rounded-xl border border-slate-600/50 bg-slate-700/50 p-3 text-slate-100 placeholder-slate-400 focus:border-rose-400/50 focus:ring-2 focus:ring-rose-400/20 backdrop-blur-sm"
              placeholder="Details..."></textarea>

    <div *ngIf="loopReportError" class="mt-2 text-sm text-rose-400">{{ loopReportError }}</div>
    <div *ngIf="loopReportSuccess" class="mt-2 text-sm text-emerald-400">{{ loopReportSuccess }}</div>

    <div class="mt-4 flex justify-end gap-2">
      <button (click)="isLoopReportOpen=false"
              class="inline-flex items-center gap-2 rounded-full border border-slate-600/50 bg-slate-700/50 px-5 py-2.5 text-sm font-medium text-slate-300 transition-all hover:bg-slate-600/50 backdrop-blur-sm">
        Cancel
      </button>
      <button (click)="submitLoopReport()"
              [disabled]="isReportingLoop || !loopReportReason.trim()"
              class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-rose-600 to-red-600 px-5 py-2.5 text-sm font-semibold text-white transition-all hover:from-rose-500 hover:to-red-500 disabled:opacity-50">
        {{ isReportingLoop ? 'Sending...' : 'Submit Report' }}
      </button>
    </div>
  </div>
</div>


<!-- COMMENT REPORT MODAL -->
<div *ngIf="isReportModalOpen"
     class="fixed inset-0 z-50 grid place-items-center bg-black/70 p-4 backdrop-blur-sm"
     (click)="closeReportModal($event)">
  <div class="relative w-full max-w-md rounded-2xl border border-slate-700/50 bg-gradient-to-b from-slate-800 to-slate-900 p-6 shadow-xl"
       (click)="$event.stopPropagation()">
    <div class="mb-4 flex items-center justify-between">
      <h3 class="text-lg font-semibold text-slate-100">Report Comment</h3>
      <button (click)="isReportModalOpen=false"
              class="rounded-full p-2 text-slate-400 hover:bg-slate-700/50 hover:text-slate-200 transition-all">
        <i class="bi bi-x-lg"></i>
      </button>
    </div>

    <p class="mb-3 text-sm text-slate-400">What’s wrong with this comment?</p>
    <textarea [(ngModel)]="reportReason"
              rows="5" maxlength="1000"
              class="w-full rounded-xl border border-slate-600/50 bg-slate-700/50 p-3 text-slate-100 placeholder-slate-400 focus:border-rose-400/50 focus:ring-2 focus:ring-rose-400/20 backdrop-blur-sm"
              placeholder="Details..."></textarea>

    <div *ngIf="reportError" class="mt-2 text-sm text-rose-400">{{ reportError }}</div>
    <div *ngIf="reportSuccess" class="mt-2 text-sm text-emerald-400">{{ reportSuccess }}</div>

    <div class="mt-4 flex justify-end gap-2">
      <button (click)="isReportModalOpen=false"
              class="inline-flex items-center gap-2 rounded-full border border-slate-600/50 bg-slate-700/50 px-5 py-2.5 text-sm font-medium text-slate-300 transition-all hover:bg-slate-600/50 backdrop-blur-sm">
        Cancel
      </button>
      <button (click)="submitReport()"
              [disabled]="isReporting || !reportReason.trim()"
              class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-rose-600 to-red-600 px-5 py-2.5 text-sm font-semibold text-white transition-all hover:from-rose-500 hover:to-red-500 disabled:opacity-50">
        {{ isReporting ? 'Sending...' : 'Submit Report' }}
      </button>
    </div>
  </div>
</div>
