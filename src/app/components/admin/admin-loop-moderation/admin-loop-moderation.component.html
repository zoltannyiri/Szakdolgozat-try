<div class="min-h-screen bg-gradient-to-br from-[#0f172a] to-[#1e293b] text-slate-100 p-6">
  <div class="max-w-7xl mx-auto space-y-8">
    <div class="rounded-2xl border border-slate-600/30 bg-gradient-to-b from-slate-800/80 to-slate-900/80 backdrop-blur-sm shadow-xl p-8">
      <div class="flex flex-col lg:flex-row justify-between items-start lg:items-center gap-6">
        <div>
          <h1 class="text-4xl font-bold bg-gradient-to-r from-amber-400 to-orange-400 bg-clip-text text-transparent">
            Loop moderáció
          </h1>
          <p class="mt-2 text-slate-400">
            Friss felhasználók feltöltéseinek elbírálása.
          </p>
        </div>
        
        <div class="flex items-center gap-4">
          <span class="rounded-xl bg-slate-700/40 px-4 py-2 text-sm font-medium text-slate-300 backdrop-blur-sm border border-slate-600/30">
            Összes: {{ pendingLoops.length || 0 }}
          </span>
          <button (click)="refresh()"
                  class="flex items-center gap-3 rounded-xl bg-gradient-to-r from-amber-600 to-orange-600 px-6 py-3 text-sm font-medium hover:from-amber-500 hover:to-orange-500 transition-all shadow-lg hover:shadow-xl"
                  title="Lista frissítése">
            <i class="bi bi-arrow-clockwise"></i>
            Frissítés
          </button>
        </div>
      </div>
    </div>

    <div *ngIf="errorMessage" class="rounded-2xl border border-rose-600/30 bg-gradient-to-b from-rose-800/80 to-rose-900/80 backdrop-blur-sm shadow-xl p-6">
      <div class="flex items-center gap-3 text-rose-300">
        <i class="bi bi-exclamation-triangle text-xl"></i>
        <div>
          <div class="font-medium">Hiba történt</div>
          <div class="text-sm mt-1">{{ errorMessage }}</div>
        </div>
      </div>
    </div>

    <div *ngIf="isLoading" class="space-y-4 p-8 animate-pulse">
      <div *ngFor="let i of [1,2,3]" class="flex items-center space-x-4">
        <div class="h-4 rounded bg-slate-700/60 flex-1"></div>
        <div class="h-4 rounded bg-slate-700/60 w-20"></div>
      </div>
    </div>

    <div *ngIf="!isLoading && (!pendingLoops || pendingLoops.length === 0)"
         class="rounded-2xl border border-slate-600/30 bg-gradient-to-b from-slate-800/80 to-slate-900/80 backdrop-blur-sm shadow-xl overflow-hidden">
      <div class="text-center py-16">
        <div class="w-24 h-24 rounded-full bg-slate-700/40 flex items-center justify-center mx-auto mb-6 backdrop-blur-sm">
          <i class="bi bi-inbox text-5xl text-slate-400"></i>
        </div>
        <h3 class="text-xl font-semibold text-slate-200 mb-3">Nincsenek függőben lévő loopok</h3>
        <p class="text-slate-400 max-w-md mx-auto">
          Amint lesz új feltöltés, itt jelenik meg.
        </p>
      </div>
    </div>

    <div class="space-y-6" *ngIf="!isLoading && pendingLoops?.length">
      <article *ngFor="let loop of pendingLoops"
               class="rounded-2xl border border-slate-600/30 bg-gradient-to-b from-slate-800/80 to-slate-900/80 backdrop-blur-sm shadow-xl p-6 transition-all hover:-translate-y-0.5 hover:shadow-2xl">
        
        <div class="mb-6 flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
          <div class="min-w-0">
            <h3 class="truncate text-xl font-semibold text-slate-100" title="{{ loop.filename }}">
              {{ loop.filename || 'ismeretlen.wav' }}
            </h3>
            <div class="mt-3 flex flex-wrap items-center gap-2 text-xs">
              <span class="inline-flex items-center gap-1 rounded-full bg-indigo-500/20 px-3 py-1.5 font-medium text-indigo-300 backdrop-blur-sm border border-indigo-500/30">
                <i class="bi bi-speedometer2"></i>
                {{ loop.bpm || '—' }} BPM
              </span>
              <span class="inline-flex items-center gap-1 rounded-full bg-sky-500/20 px-3 py-1.5 font-medium text-sky-300 backdrop-blur-sm border border-sky-500/30">
                <i class="bi bi-music-note"></i>
                {{ loop.key || '—' }} {{ loop.scale || '' }}
              </span>
              <span class="inline-flex items-center gap-1 rounded-full bg-emerald-500/20 px-3 py-1.5 font-medium text-emerald-300 backdrop-blur-sm border border-emerald-500/30">
                <i class="bi bi-speaker"></i>
                {{ loop.instrument || '—' }}
              </span>
              <span class="inline-flex items-center gap-1 rounded-full bg-amber-500/20 px-3 py-1.5 font-medium text-amber-300 backdrop-blur-sm border border-amber-500/30"
                    *ngIf="loop.uploadDate">
                <i class="bi bi-calendar3"></i>
                {{ loop.uploadDate | date:'yyyy.MM.dd. HH:mm' }}
              </span>
            </div>
          </div>

          <div class="flex items-center gap-3 shrink-0">
            <div class="grid h-12 w-12 place-items-center rounded-full bg-slate-700/60 text-sm font-semibold text-slate-300 backdrop-blur-sm border border-slate-600/30">
              {{ (loop.uploader?.username || ' ? ') | slice:0:2 | uppercase }}
            </div>
            <div class="text-right">
              <div class="text-sm font-medium text-slate-300">Feltöltő</div>
              <div class="text-sm text-slate-400">
                {{ loop.uploader?.username || 'Ismeretlen' }}
              </div>
            </div>
          </div>
        </div>

        <div class="mb-6 grid grid-cols-1 gap-5 lg:grid-cols-3">
          <div class="lg:col-span-2">
            <div class="mb-3 text-sm font-medium text-slate-300">Címkék</div>
            <div class="flex flex-wrap gap-2">
              <ng-container *ngIf="loop.tags?.length; else noTags">
                <span *ngFor="let tag of loop.tags"
                      class="inline-flex items-center gap-1 rounded-full bg-slate-700/40 px-3 py-1.5 text-xs text-slate-300 backdrop-blur-sm border border-slate-600/30">
                  <i class="bi bi-tag-fill text-amber-400"></i>{{ tag }}
                </span>
              </ng-container>
              <ng-template #noTags>
                <span class="text-sm text-slate-400">Nincsenek tagek</span>
              </ng-template>
            </div>
          </div>

          <div class="rounded-xl border border-slate-600/30 bg-slate-700/40 p-4 backdrop-blur-sm">
            <div class="mb-3 text-sm font-medium text-slate-300">Előnézet</div>
            <audio [src]="loop.path" controls class="w-full rounded-lg"></audio>
          </div>
        </div>

        <div class="flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
          <div class="flex-1">
            <label class="mb-2 block text-sm font-medium text-slate-300">Elutasítás indoka</label>
            <input type="text"
                   [(ngModel)]="reasonMap[loop._id]"
                   placeholder="Pl. téves BPM / rossz skála / hiányos meta…"
                   class="w-full rounded-xl border border-slate-600/30 bg-slate-700/40 backdrop-blur-sm px-4 py-3 text-sm text-slate-100 placeholder-slate-400 focus:border-rose-500/50 focus:ring-2 focus:ring-rose-500/30 transition-all"/>
            <p class="mt-2 text-xs text-slate-400">Jóváhagyáshoz nem kötelező, elutasításhoz ajánlott.</p>
          </div>

          <div class="flex shrink-0 items-center gap-3">
            <button (click)="approve(loop)"
                    class="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-emerald-600 to-green-600 px-6 py-3 text-sm font-medium text-white hover:from-emerald-500 hover:to-green-500 transition-all shadow-lg hover:shadow-xl group/tooltip relative">
              <i class="bi bi-check-circle"></i>
              Jóváhagyás
              <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-slate-800 text-xs text-white px-2 py-1 rounded opacity-0 group-hover/tooltip:opacity-100 transition-opacity whitespace-nowrap">
                Loop jóváhagyása
              </div>
            </button>
            
            <button (click)="reject(loop, reasonMap[loop._id])"
                    class="inline-flex items-center gap-2 rounded-xl bg-gradient-to-r from-rose-600 to-red-600 px-6 py-3 text-sm font-medium text-white hover:from-rose-500 hover:to-red-500 transition-all shadow-lg hover:shadow-xl group/tooltip relative">
              <i class="bi bi-x-circle"></i>
              Elutasítás
              <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-slate-800 text-xs text-white px-2 py-1 rounded opacity-0 group-hover/tooltip:opacity-100 transition-opacity whitespace-nowrap">
                Loop elutasítása
              </div>
            </button>
            
            <a [routerLink]="['/loop-detail', loop._id]"
               class="inline-flex items-center gap-2 rounded-xl border border-slate-600/30 bg-slate-700/40 backdrop-blur-sm px-6 py-3 text-sm font-medium text-slate-300 hover:bg-slate-600/40 transition-all group/tooltip relative">
              <i class="bi bi-box-arrow-up-right"></i>
              Részletek
              <div class="absolute -top-8 left-1/2 transform -translate-x-1/2 bg-slate-800 text-xs text-white px-2 py-1 rounded opacity-0 group-hover/tooltip:opacity-100 transition-opacity whitespace-nowrap">
                Loop részletei
              </div>
            </a>
          </div>
        </div>
      </article>
    </div>
  </div>
</div>